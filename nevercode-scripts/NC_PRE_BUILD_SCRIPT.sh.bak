#!/bin/sh

set -e
set -x

if [ "$NEVERCODE_PULL_REQUEST" = "true" ]
then
    CHANNEL=$NEVERCODE_PULL_REQUEST_NUMBER
else
    CHANNEL="develop-native"
fi

npm install -g expo-cli@2.2.0
expo login -u $EXPO_USERNAME -p $EXPO_PASSWORD
expo publish --release-channel $CHANNEL
sed -i'.original' -e "s/react-native-scaffold/react-native-scaffold?release-channel=${CHANNEL}/" android/app/src/main/java/host/exp/exponent/generated/AppConstants.java
sed -i'.original' -e "s/default/${CHANNEL}/" android/app/src/main/java/host/exp/exponent/generated/AppConstants.java
